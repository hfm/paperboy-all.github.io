<!doctype html>
<html>
  <head>
    <meta charset="utf-8">

    <!-- Always force latest IE rendering engine or request Chrome Frame -->
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">

    <!-- Use title if it's in the page YAML frontmatter -->
    <title>Puppetマニフェストスタイルガイド</title>

    <link href="/stylesheets/normalize.css" media="screen" rel="stylesheet" type="text/css" />
<link href="/stylesheets/all.css" media="screen" rel="stylesheet" type="text/css" />
    <script src="/javascripts/all.js" type="text/javascript"></script>
  </head>

  <body class="docs docs_puppet docs_puppet_style-guide">
    <h1 id="manifest">manifestコーディング規約</h1>

<p>manifestのコーディング規約を決めとこう。</p>

<p>基本的には本家のここに従う。<a href="http://docs.puppetlabs.com/guides/style_guide.html">Style Guide</a></p>

<p>いくつか気になるのをピックアップすると。</p>

<ul>
  <li>リソースパラメータのデフォルト値はトップレベルスコープにしか置かない(各クラス内で設定しない)。</li>
</ul>

<blockquote>
  <p>9.7. Resource Defaults</p>

  <p>Resource defaults should be used in a very controlled manner, and should only be declared at the edges of your manifest ecosystem. Specifically, they may be declared:</p>

  <p>At top scope in site.pp
       In a class which is guaranteed to never declare another class and never be inherited by another class.</p>

  <pre><code>   This is due to the way resource defaults propagate through dynamic scope, which can have unpredictable effects far away from where the default was declared.
</code></pre>
</blockquote>

<ul>
  <li>トップレベルの変数をmodule内で使うときは$::をつける</li>
</ul>

<blockquote>
  <p>11.6. Namespacing Variables</p>

  <p>When using top-scope variables, including facts, Puppet modules should explicitly specify the empty namespace (i.e., $::operatingsystem, not $operatingsystem) to prevent accidental scoping issues.</p>
</blockquote>

<ul>
  <li>変数にハイフンを使わない</li>
</ul>

<blockquote>
  <p>11.7. Variable format</p>

  <p>When defining variables you should only use letters, numbers and underscores. You should specifically not make use of dashes.</p>
</blockquote>

<ul>
  <li>classのネストや、class内でのdefined resource定義をしない</li>
</ul>

<blockquote>
  <p>11.4. Classes and Defined Resource Types Within Classes</p>

  <p>Classes and defined resource types must not be defined within other classes.</p>
</blockquote>

<hr />

<h2 id="section">ペパボ独自規約</h2>

<h3 id="mode">modeのクオート</h3>
<p>本家では、ファイルのmodeも 「4桁でクオートすれ」ってあるけど、なんとなく気に食わないので、</p>

<pre><code># 3桁でクオート無し
mode =&gt; 644
</code></pre>

<p>を基本とします。</p>

<h3 id="section-1">パラメータ引数とリソース名のクオート</h3>

<p>本家では、「変数使うときはダブル、じゃないときはシングル」ってあるけど、エディタでみたときにシンタックスカラーがごっちゃりして解りにくいので、こうします。</p>

<pre><code># リソースネームはシングル(変数あるときはダブル)、他は変数含もうが含むまいが全部ダブル。
file { '//foo/baa':
  source =&gt; "puppet:///foo/baa",
 }
</code></pre>

<h3 id="section-2">予約語となっているパラメータ引数はクオートしない</h3>

<p><strong>Good:</strong></p>

<pre><code>file { '/tmp':
  ensure =&gt; directory,
}
</code></pre>

<p><strong>Bad:</strong></p>

<pre><code>file { '/tmp':
  ensure =&gt; "directory",
}
</code></pre>

<h3 id="section-3">同一タイプリソースの間に空行</h3>

<p>パラメータが多いと、複数並んだ時に見づらいため、一行空けます。</p>

<pre><code>file {
  '/foo/baa':
    source  =&gt; "puppet///foo/baa",
    mode    =&gt; 644,
    require =&gt; File['/foo'];

  '/aaa/bbb':
    content =&gt; template("aaa/bbb"),
    mode    =&gt; 755;
}
</code></pre>

<h3 id="require">複数requireで改行</h3>

<p>横に並べるとあとから編集しにくいので改行いれる。</p>

<pre><code>sevice { 'mydaemon':
  ensure  =&gt; running,
  require =&gt; [
    Package['mydaemon'],
    File['mydaemon.conf'],
  ]
}
</code></pre>

<h3 id="include-1">include は1つずつ</h3>

<p>横に並べない。includeの順はそれなりに処理順でもあるので、横並びだと、順番を変えたい時に編集がめんどうです。</p>

<pre><code># これダメ
include base, base::config, base::packages
# こう
include base
include base::config
include base::packages
</code></pre>

  </body>
</html>
